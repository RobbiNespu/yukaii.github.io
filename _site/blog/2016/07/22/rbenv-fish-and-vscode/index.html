<!DOCTYPE html>
<html>

  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="shortcut icon" href="/favicon.ico?">
  <link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico?">
  <link rel="icon" type="image/png" sizes="196x196" href="/assets/favicon-192.png?">
  <link rel="icon" type="image/png" sizes="160x160" href="/assets/favicon-160.png?">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon-96.png?">
  <link rel="icon" type="image/png" sizes="64x64" href="/assets/favicon-64.png?">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32.png?">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16.png?">
  <link rel="apple-touch-icon" href="/assets/favicon-57.png?">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/favicon-114.png?">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/favicon-72.png?">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/favicon-144.png?">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/favicon-60.png?">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/favicon-120.png?">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/favicon-76.png?">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/favicon-152.png?">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon-180.png?">

  <title>rbenv、fish 與 VSCode 設置之路</title>
  <meta name="description" content="在最新的 VSCode 1.3.1 版裡，Integrated Terminal 變得更佳好用，但由於上游套件 xterm.js 的緣故，zsh 還是有無法捲動的問題。不過作為一個 Rails 開發者，VSCode 已經是個足夠好用的、足矣媲美 Sublime Text 的編輯器了。為了能夠在 VSCode 開發...">

  <link type="text/css" rel="stylesheet" href="/assets/main.css">
  <link type="text/css" rel="stylesheet" href="/assets/primer.css">
  <link rel="canonical" href="http://yukaii.tw/blog/2016/07/22/rbenv-fish-and-vscode/">
  <link rel="alternate" type="application/rss+xml" title="Daily Oops!" href="http://yukaii.tw/feed.xml">
</head>


  <body>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-49526118-7', 'auto');
  ga('send', 'pageview');

</script>

    <header class="site-header">

  <div class="title-wrapper">
    <h1>
      <a class="site-title" href="/">Daily Oops!</a>
    </h1>
  </div>


  <div class="wrapper">
    <div class="tabnav">
      <nav class="tabnav-tabs">
        
          
            <a href="/about/" class="tabnav-tab">About</a>
          
        
          
        
          
            <a href="/blog/" class="tabnav-tab">Blog</a>
          
        
          
            <a href="/hi-tips/" class="tabnav-tab">Hi Tips!</a>
          
        
          
        
          
            <a href="/portfolio/" class="tabnav-tab">Portfolio</a>
          
        
      </nav>
    </div>
  </div>


</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post markdown-body" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">rbenv、fish 與 VSCode 設置之路</h1>
    <p class="post-meta"><time datetime="2016-07-22T00:00:00+08:00" itemprop="datePublished">Jul 22, 2016</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>在最新的 VSCode 1.3.1 版裡，Integrated Terminal 變得更佳好用，但由於上游套件 <code>xterm.js</code> 的緣故，<code>zsh</code> 還是有無法捲動的問題。不過作為一個 Rails 開發者，VSCode 已經是個足夠好用的、足矣媲美 Sublime Text 的編輯器了。為了能夠在 VSCode 開發 Rails，特別對目前的開發環境做出調整。</p>

<h2>由 RVM 轉換至 rbenv</h2>

<p>聽聞 <a href="https://github.com/rbenv/rbenv">rbenv</a> 相較 rvm 來說，是對系統較為乾淨的 ruby 版本管理工具。就趁這次更新開發環境一起重置吧！</p>

<h3>移除 rvm</h3>

<p>套件也內建了一鍵移除的方式：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rvm implode
</code></pre></div>
<p>做完之後也可以將 rvm 剩餘的檔案移掉：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rm -rf ~/.rvm
</code></pre></div>
<h3>安裝 rbenv</h3>

<p>參照了<a href="https://github.com/rbenv/rbenv">專案官網</a>的說明，只要把該 repo clone 下來，設置好 <code>PATH</code> 變數，在為 shell 加上一些設定便可以開始安裝 ruby 了。在 OS X 環境又更容易，只要用 Homebrew 一鍵安裝便成。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">brew install rbenv
</code></pre></div>
<p>裝完之後就可以發現 rbenv 已經被裝到 Homebrew 的可執行位置了，可以跑 <code>which</code> 指令檢驗</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">which rbenv
<span class="c"># =&gt; /usr/local/bin/rbenv</span>
</code></pre></div>
<p>在 Homebrew 安裝跑完之後，安裝腳本會提示已在 shell profile(.zshrc/.profile/.bash_profile) 加上 rbenv 初始化腳本，預設內容如下：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.rbenv/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
<span class="nb">eval</span> <span class="s2">"</span><span class="k">$(</span>rbenv init -<span class="k">)</span><span class="s2">"</span>
</code></pre></div>
<p>第二行的 <code>rbenv init -</code> 指令輸出，在你一般開啟的 Terminal 會跑出：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"/Users/USERNAME/.rbenv/shims:</span><span class="k">${</span><span class="nv">PATH</span><span class="k">}</span><span class="s2">"</span>
<span class="nb">export </span><span class="nv">RBENV_SHELL</span><span class="o">=</span>zsh
<span class="nb">source</span> <span class="s1">'/usr/local/Cellar/rbenv/1.0.0/libexec/../completions/rbenv.zsh'</span>
<span class="c"># ... 下面一串</span>
</code></pre></div>
<p>不過在 VSCode 內建終端機卻會跑出：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"/usr/local/opt/rbenv/shims:</span><span class="k">${</span><span class="nv">PATH</span><span class="k">}</span><span class="s2">"</span> <span class="c"># 就這行不同</span>
<span class="nb">export </span><span class="nv">RBENV_SHELL</span><span class="o">=</span>zsh

<span class="c"># ... 下面一樣</span>
</code></pre></div>
<p>大概是執行權限不同的關係吧，rbenv 執行的位置不同也會讓 <code>gem</code>/<code>bundler</code> 裝到不同的位置，為了方便起見，一律設成一般終端機跑出來的那串。把下面這串貼到 <code>~/.zshrc</code> 最下面就是。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"/Users/USERNAME/.rbenv/shims:</span><span class="k">${</span><span class="nv">PATH</span><span class="k">}</span><span class="s2">"</span>
<span class="nb">export </span><span class="nv">RBENV_SHELL</span><span class="o">=</span>zsh
<span class="nb">source</span> <span class="s1">'/usr/local/Cellar/rbenv/1.0.0/libexec/../completions/rbenv.zsh'</span>
<span class="nb">command </span>rbenv rehash 2&gt;/dev/null
rbenv<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local command
  command</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"$#"</span> -gt 0 <span class="o">]</span>; <span class="k">then
    </span><span class="nb">shift
  </span><span class="k">fi

  case</span> <span class="s2">"</span><span class="nv">$command</span><span class="s2">"</span> <span class="k">in
  </span>rehash|shell<span class="p">)</span>
    <span class="nb">eval</span> <span class="s2">"</span><span class="k">$(</span>rbenv <span class="s2">"sh-</span><span class="nv">$command</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="k">)</span><span class="s2">"</span><span class="p">;;</span>
  <span class="k">*</span><span class="p">)</span>
    <span class="nb">command </span>rbenv <span class="s2">"</span><span class="nv">$command</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="p">;;</span>
  <span class="k">esac</span>
<span class="o">}</span>
</code></pre></div>
<p>若是 fish 就貼下面這個：</p>
<div class="highlight"><pre><code class="language-" data-lang="">setenv PATH '/Users/USERNAME/.rbenv/shims' $PATH
setenv RBENV_SHELL fish
. '/usr/local/Cellar/rbenv/1.0.0/libexec/../completions/rbenv.fish'
command rbenv rehash 2&gt;/dev/null
function rbenv
  set command $argv[1]
  set -e argv[1]

  switch "$command"
  case rehash shell
    . (rbenv "sh-$command" $argv|psub)
  case '*'
    command rbenv "$command" $argv
  end
end
</code></pre></div>
<h3>裝 ruby</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rbenv install 2.3.1
rbenv global 2.3.1
gem install bundler

bundle install
</code></pre></div>
<p>搞定！</p>

<h3>Pow 的額外設定</h3>

<p>其實在 Pow 的 <a href="https://github.com/basecamp/pow/wiki/Troubleshooting">wiki</a> 就有解答，不過因為我又對 rbenv 做了 PATH 的改動，所以設定也不太一樣。</p>

<p>打開 ~/.powconfig 並貼入</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"/Users/USERNAME/.rbenv/shims:/Users/USERNAME/.rbenv/shims/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
</code></pre></div>
<p>然後重啟 pow service</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">touch ~/.pow/restart.txt
</code></pre></div>
<h2>將主要 shell 由 zsh 換成 fish</h2>

<p>zsh 有著非常有名的 <a href="https://github.com/robbyrussell/oh-my-zsh">oh-my-zsh</a> 設定檔管理框架，fish 底下也有個好用的叫 <a href="https://github.com/fisherman/fisherman">fisherman</a>。不過我終究是沒有把系統預設的 shell 換掉(<code>chsh</code> 指令)，因為挺多工具與 fish 不相容。</p>

<p>fish 啟動速度飛快，帶我重回還沒有裝一堆 zsh 套件的美好往日時光。</p>

<h3>VSCode</h3>

<p>講來講去這篇好像跟 VSCode 沒啥關係耶？那就附張截圖好了，VSCode 也是十分優秀的 Markdown 編輯器，內建了快速的 Preview，碼 code、寫文件、Terminal、Task Runner 全都內建了，還夠輕量快速，Extension 也陸續多了起來，還真不好挑剔啊 XD。</p>

<p><img src="https://lh3.googleusercontent.com/-o17HvZ1w7k6NzK0kw84uJNdhTmnWCH1hGyHduSokRnhgdeoaIh8reqDVrlAc43uGIN9K5KZYpujZuuSdqrV5BiuBhYNsQlubHEfAPut1pGvbkYzw3zKLfuEpphlj7JpBKj9x3m-Zk-rA4s-xFXnagC3vO8otXWOAH7qXYg47kx8D1qHVDpwHjD4WW8yd1jV_CYZlL5VWfrbbiVAdlwBDalB_UexT8emkhqTMjNwQMhIwMyqEXk8LcsfuI5IqgpdR488KovW9Z3ckMJjMbMWSpYOUfMuJ4_pRgYPMla9cm-h6QcP5PXIyhfTERUTRUyUAawcJAWC74R519UVe_gLizh0RqvKazWU0ISCjXVOmbH_bljBAwRIBZobMme9W3deBztAMd0asjKFJnjsviDKDgb1n5y8wS6z5nfNGWijNJbl2JwpVv9EVStbGM4OoqM-9st2MO5oVZJEK8PgtNp1LvuBr3Qkch_k2RXnSZJTfxs4aYZroTJTplZI2XEZS8bkK6Xlczod9rFAvsBdSK2G1A3rixmyBrTOkb7YE7Z8E5NRGWXx3mJns607eu00e69bzGlSe7kc_IpwN1wiYUtqWuRjABPqIhsV=w1046-h781-no" alt=""></p>

  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Daily Oops!</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Daily Oops!</li>
          <li><a href="mailto:yukaihuangtw@gmail.com">yukaihuangtw@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/Yukaii"><span class="icon icon--github"><svg viewbox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path></svg>
</span><span class="username">Yukaii</span></a>

          </li>
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Yukai's blog. Life, music, web, and all the fun.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
